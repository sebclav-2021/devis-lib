<!doctype html>
<html>
  <head>
    <meta charset='utf-8' />
    <style>
      .container {
        background-color: whitesmoke;
        display: flex;
        justify-content: space-between;
        flex-direction: column;
      }

      .user {
        text-align:left;
        display: flex;
        flex-direction: column;
        width: 50%;

      }

      .customer {
        text-align: left;
        display: flex;
        flex-direction: column;
        text-align: right;
      }

      .custom {
        margin-top: 80px;
      }

      .customer-container {
        display: flex;
        justify-content: flex-end;

      }
    </style>
  </head>

  <body onload='number_pages'>

    <div id="content">
      <div class="container">
        <div class="user">
            <p><%=current_user.name%></p>
            <p><%=current_user.address%></p>
            <p>Email: <%=current_user.email%></p>
            <p>Téléphone: <%=current_user.phone%></p>
            <p>N°Siret: <%=current_user.siret%></p>
        </div>
        <div class="customer-container">
          <div class="customer">
              <p><%=@quote.customer.name%></p>
              <p><%=@quote.customer.address%></p>
              <p><%=@quote.customer.phone%></p>
              <p><%=@quote.customer.email%></p>
          </div>
        </div>
        <br>
        <br>
        <div class="date">
          <p> Fait le <%= @quote.created_at.strftime("%d-%m-%Y") %></p>
        </div>
        <br>
        <br>

        <div>
          <% @prices = [] %>
          <% @categories.each do |category| %>
            <h2><%= category %></h2>

            <div>
              <% @lines_to_display[category].each do |line| %>
                <p><%= line.service.name %> Quantité : <%= line.quantity %> <%= line.service.supplies.map(&:product).map(&:unite).join(', ') %></p>
                <p><%= line.service.description %> </p>
                <p><%= line.service.supplies.map(&:product).map(&:name).join(', ') %></p>
                <p><%= line.service.supplies.map(&:product).map(&:price).join(', ') %> €</p>
                <% @prices << line.service.supplies.map(&:product).map(&:price).join(', ')%>
              <% end %>
            </div>
          <% end %>
        </div>
        <div>
          <% @sum = 0 %>
          <% @prices.each { |a| @sum+=a.to_i }  %>
          <p> Total : <%= @sum %> €</p>
        </div>

        <div>
          <p>Accompte : 30%</p>
          <p>Validité du devis : 3 mois</p>
        </div>

      </div>
    </div>
  </body>
</html>
